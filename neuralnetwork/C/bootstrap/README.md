# UQ by bootstrap

The ensemble is generated by training the model using different bootstrap dataset.
The bootstrap dataset is generated by resampling the original, full training dataset with replacement, making each instance slightly different than the others.
In practice, the bootstrap dataset are generated by resampling in the atomic configuration level, instead of individual data level.
The functionality to generate bootstrap dataset has been implemented in [KLIFF](https://github.com/openkim/kliff/blob/main/kliff/uq/bootstrap.py).

Then, to compare the uncertainty obtained using bootstrap ensemble against other UQ methods, we propagate the uncertainty to some target quantities, as described below.


## Content and workflow

1. First, run `python bootstrap_generate_configs.py` to generate a JSON file that contains information on how to construct the bootstrap dataset.
   The exported file is named `bootstrap_fingerprints_<partition>.json`.
2. The script `bootstrap_single_set.py` runs the training using a single bootstrap dataset, and thus it will produce a single member of the ensemble.
   The main script to generate the entire ensemble is `bootstrap_submit_job.py`.
   This job iterates over different bootstrap dataset, writes a slurm file, then submit the job to the super computer that runs `bootstrap_single_set.py` for each random seed.
   Thus, the end product is the entire ensemble.
3. Follow the calculation by installing the KIM model members of the emsemble using `python bootstrap_install_uninstall.py install` command.
4. Then, to reduce the number of files produce, e.g., if there is a limit of file count, run `python bootstrap_archive_saved_models.py`.
   This will combine and aarchive the saved models exported during the training for each ensemble.
   Running this command will create a file named `results/<partition>_partition/<ensemble_id>/models/models.tar.gz`, where `ensemble_id` is a number from 000 to 099.
5. Uncertainty of the configuration energy per atom for the configurations in the test set.
   `uncertainty_accuracy_energies.ipynb` and `uncertainty_accuracy_energies.py` correspond to this calculation.
   The notebook has additional commands to plot the results.
6. Uncertainty of equilibrium lattice constant and cohesive energy for a monolayer graphene at 0~K.
   Use `uncertainty_latconst_ecoh.ipynb` to do this calculation.
7. Uncertainty of energy as a function of lattice parameter for a monolayer graphene at 0~K under uniform in-plane compression and stretching.
   Use `uncertainty_energy_vs_latconst.ipynb` to do this calculation.
8. Uncertainty of phonon dispersion for a monolayer graphene at 0~K along $\Gamma - M - K - \Gamma$ band path.
   The phonon calculation in `uncertainty_phonon_dispersion.ipynb` is done using ASE.
9. Uncertainty of finite temperature virial stress of graphene at 300~K.
   The ensemble calculation is done using `uncertainty_virial_stress_runmd.py` Python script, and `uncertainty_virial_stress_submitjobs.py` is used to submit the jobs to the supercomputer.
   Then, use `uncertainty_virial_stress.ipynb` to present the results.
